<link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation/5.0.2/css/foundation.css"/>
<div class="result">
  
  <h1>Your internet speed is...</h1>
  <div class="panel" id="results">
    
    Still waiting for the meassurements.
    
  </div>
  
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js">

/**
 * This function performs a synchronous request
 * and returns an object contain informations about the download
 * time and size
 */
function measure(filename) {
  var xhr = new XMLHttpRequest();
  var measure = {};
  xhr.open("GET", filename + '?' + (new Date()).getTime(), false);
  measure.start = (new Date()).getTime();
  xhr.send(null);
  measure.end = (new Date()).getTime();
  measure.len = parseInt(xhr.getResponseHeader('Content-Length') || 0);
  measure.delta = measure.end - measure.start;
  return measure;
}

/**
 * Requires that we pass a base url to the worker
 * The worker will measure the download time needed to get
 * a ~0KB and a 100KB.
 * It will return a string that serializes this informations as
 * pipe separated values
 */
onmessage = function(e) {
  measure0 = measure(e.data.base_url + '/test/0.bz2');
  measure100 = measure(e.data.base_url + '/test/100K.bz2');
  postMessage(
    measure0.delta + '|' +
    measure0.len + '|' +
    measure100.delta + '|' +
    measure100.len
  );
};
</script>



<style>
  
  .result {
     width: 66%;
     margin: 0 auto;
     padding: 1.5em;
}
 #results {
     border: 1px solid #3498db;
}
  
</style>

<h1 id="progress">JavaScript is turned off, or your browser is realllllly slow</h1>
